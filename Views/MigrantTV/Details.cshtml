@model TercumanTakipWeb.Models.ViewModels.MigrantTVVM

@{
    ViewData["Title"] = "Detaylar";

    var userLevel = User.Claims.FirstOrDefault(x => x.Type == "Seviye")?.Value;
    var currentUserName = User.Claims.FirstOrDefault(x => x.Type == System.Security.Claims.ClaimTypes.Name)?.Value;
    var modelUserName = Model.isTakipListesi_MigrantTV.KullaniciAdi;
    var fileId = Model.isTakipListesi_MigrantTV.id;

}

<head>
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
</head>

<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3>Çeviri Bilgileri</h3>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Dil</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.Dil)</dd>

                <dt class="col-sm-3">Çeviri Konusu</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.CeviriKonusu)</dd>

                <dt class="col-sm-3">Çeviri Tarihi</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.CeviriTarihi)</dd>

                <dt class="col-sm-3">Kelime Sayısı</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.KelimeSayisi)</dd>

                <dt class="col-sm-3">Seslendirme Sayısı</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.SeslendirmeSayisi)</dd>

                <dt class="col-sm-3">Ek Bilgi</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.EkBilgi)</dd>

                <dt class="col-sm-3">Kullanıcı Adı</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.isTakipListesi_MigrantTV.KullaniciAdi)</dd>

                <dt class="col-sm-3">Kayıt Tarihi</dt>
                <dd class="col-sm-9">@string.Format("{0:dd/MM/yyyy}", Model.isTakipListesi_MigrantTV.KayitTarihi)</dd>
            </dl>
        </div>
    </div>
    <div class="text-center mt-4">
        @if (currentUserName == modelUserName || userLevel == "60" || userLevel == "100")
        {
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#EditModal">Düzenle</button>
            <button type="button" class="btn btn-danger" onclick="confirmDelete('@fileId')">Sil</button>
        }
        <a asp-action="Index" class="btn btn-secondary">Listeye Geri Dön</a>
    </div>
</div>

<div class="modal fade" id="EditModal" tabindex="-1" aria-labelledby="EditModal" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Kaydı Düzenle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form asp-action="Edit" asp-route-id="@Model.isTakipListesi_MigrantTV.id">
                    <input asp-for="isTakipListesi_MigrantTV.id" hidden />
                    <input asp-for="isTakipListesi_MigrantTV.KullaniciAdi" hidden />

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.Dil" class="control-label"></label>
                        <div class="list-group checkbox-group required">
                            @for (int i = 0; i < Model.DilCheckbox.Count; i++)
                            {
                                <label class="list-group-item">
                                    <input asp-for="@Model.DilCheckbox[i].isChecked" class="form-check-input me-1" type="checkbox" />
                                    @Model.DilCheckbox[i].Dil
                                </label>
                                <input type="hidden" value="@Model.DilListesi[i]" asp-for="@Model.DilCheckbox[i].Dil" />
                            }
                        </div>
                        <span asp-validation-for="isTakipListesi_MigrantTV.Dil" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.CeviriKonusu" class="control-label"></label>
                        <input asp-for="isTakipListesi_MigrantTV.CeviriKonusu" class="form-control" />
                        <span asp-validation-for="isTakipListesi_MigrantTV.CeviriKonusu" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.CeviriTarihi" class="control-label"></label>
                        <input asp-for="isTakipListesi_MigrantTV.CeviriTarihi" class="form-control" type="date" />
                        <span asp-validation-for="isTakipListesi_MigrantTV.CeviriTarihi" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.KelimeSayisi" class="control-label"></label>
                        <input asp-for="isTakipListesi_MigrantTV.KelimeSayisi" class="form-control" type="number" />
                        <span asp-validation-for="isTakipListesi_MigrantTV.KelimeSayisi" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.SeslendirmeSayisi" class="control-label"></label>
                        <input asp-for="isTakipListesi_MigrantTV.SeslendirmeSayisi" class="form-control" type="number" />
                        <span asp-validation-for="isTakipListesi_MigrantTV.SeslendirmeSayisi" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="isTakipListesi_MigrantTV.EkBilgi" class="control-label"></label>
                        <textarea asp-for="isTakipListesi_MigrantTV.EkBilgi" class="form-control"></textarea>
                        <span asp-validation-for="isTakipListesi_MigrantTV.EkBilgi" class="text-danger"></span>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                        <button type="submit" class="btn btn-primary">Düzenlemeyi Kaydet</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <script>
        function confirmDelete(itemId) {
            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu işlem geri alınamaz!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Evet, sil!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/MigrantTV/Delete/' + itemId,
                        type: 'POST',
                        success: function (response) {
                            Swal.fire('Silindi!', 'Kayıt başarıyla silindi.', 'success').then(() => {
                                window.location.href = '/MigrantTV/Index';
                            });
                        },
                        error: function (xhr, status, error) {
                            Swal.fire('Hata!', 'Silme işlemi başarısız oldu.', 'error');
                        }
                    });
                }
            });
        }
    </script>
}